### Текущие Остатки
Получить текущие остатки в компактном виде можно с помощью эндпоинтов `/report/stock/all/current` и `/report/stock/bystore/current`.

Эндпоинты предназначены для частого и быстрого обновления остатков большого количества номенклатуры.

Отличия от стандартного запроса остатков:

- быстрая работа с большим объемом номенклатуры
- все остатки на одной странице, без постраничной выдачи
- точное указание складов, вложенные склады не учитываются
- при разделении по складам, строка без склада содержит резервы, не привязанные к складу
- возвращается только один вид остатков, указанный в параметре stockType
- может вызываться только администратором
- отсутствие сортировки, результат в произвольном порядке

#### Параметр include
По умолчанию выводятся только результаты с ненулевым значением остатка.
Для вывода нулевых остатков, необходимо добавить параметр `include=zeroLines`.

#### Параметр changedSince
По умолчанию выводятся остатки на текущий момент. Параметром `changedSince` можно получить остатки,
которые изменились в интервале между временем указанным в параметре `changedSince` и текущим моментом.
Остатки в ответах на эндпоинты `/report/stock/all/current` и `/report/stock/bystore/current` 
это фактический остаток на текущий момент времени на всех складах и с разбивкой по складам соответственно, не дельта за период, 
не остаток на момент времени `changedSince`, а фактический остаток по номенклатуре, у которой изменился остаток за интервал.
Формат значения параметра - строка вида "гггг-мм-дд чч-мм-сс". Пример: `changedSince=2016-08-23 15:21:09`. [Подробнее тут](https://dev.moysklad.ru/doc/api/remap/1.2/#mojsklad-json-api-obschie-swedeniq-format-daty-i-wremeni)

Ограничения и рекомендации, накладываемые на параметр:

- При использовании параметра `changedSince` всегда включен вывод нулевых остатков. Независимо от отсутствия или наличия параметра `include=zeroLines`.
- Максимальное значение параметра `changedSince` в прошлое от текущего момента не должно превышать 24 часа.
- Минимальное значение параметра `changedSince` в прошлое от текущего момента не ограничено.
- Параметр `changedSince` не может превышать текущий момент. 
- Небольшое перекрытие интервалов запросов поможет исключить потерю обновления остатков на границах интервалов (пример: запрос остатков каждые 30 минут за прошедшие 35 минут). 
- Рекомендуется проводить полную синхронизацию остатков без параметра `changedSince` раз в сутки и более, в зависимости от частоты изменения остатков.

Важно: если за запрашиваемый интервал был удален (не архивирован) товар или склад, то будет выведен остаток равный 0. Стоит учитывать, что по id запросить этот товар или склад уже не получится.

#### Параметр stockType
Параметром `stockType` выбирается тип остатка, который необходимо рассчитать.
На данный момент возможно получить только один тип остатка.
Значение по умолчанию - `stock`

| Значение      | Описание                                                    |
| ------------- | ----------------------------------------------------------- |
| **stock**     | Физический остаток на складах, без учёта резерва и ожидания |
| **freeStock** | Остаток на складах за вычетом резерва                       |
| **quantity**  | Доступно. Учитывает резерв и ожидания                       |

#### Доступные фильтры отчёта Текущие Остатки
Можно ограничить отчёт несколькими товарами или складами.
Указывается id сущности, а не url.

| Значение          | Тип    | Фильтрация | Описание                                                     |
| ----------------- | :----- | :--------- | ------------------------------------------------------------ |
| **assortmentId**  | UUID   | `=`        | Выдать в отчёте только указанные товары, модификации и серии |
| **storeId**       | UUID   | `=`        | Выдать в отчёте только указанные склады                      |

Несколько значений можно указать через запятую или через несколько параметров:

- `filter=assortmentId=00000000-0000-0000-0000-000000000001,00000000-0000-0000-0000-000000000002`
- `filter=assortmentId=00000000-0000-0000-0000-000000000001;assortmentId=00000000-0000-0000-0000-000000000002`
- `filter=assortmentId=00000000-0000-0000-0000-000000000001&filter=assortmentId=00000000-0000-0000-0000-000000000002`

#### Примеры запросов
> Запрос на получение текущих остатков без разбиения по складам.

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/report/stock/all/current"
  -H "Authorization: Basic <Credentials>"
```

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отчета.

```json
[
  {"assortmentId":"12345678-5838-aaeb-0a80-003a003ef439","stock":11},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f847c","stock":46.5}
]
```

> Запрос на получение текущих остатков "доступно" с выводом нулевых значений.

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/report/stock/all/current?stockType=quantity&include=zeroLines"
  -H "Authorization: Basic <Credentials>"
```

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отчета.

```json
[
  {"assortmentId":"12345678-5838-aaeb-0a80-003a003ef439","quantity":11},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f1981","quantity":0},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f847c","quantity":46.5},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f3215","quantity":0}
]
```

> Запрос на получение остатков с параметром "changedSince".

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/report/stock/all/current?changedSince=2022-08-23 15:00:00"
  -H "Authorization: Basic <Credentials>"
```

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отчета.

```json
[
  {"assortmentId":"12345678-5838-aaeb-0a80-003a003ef439","quantity":1},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f847c","quantity":4.5}
]
```

> Запрос на получение текущих остатков по складам с указанием типа остатка.

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/report/stock/bystore/current?stockType=freeStock"
  -H "Authorization: Basic <Credentials>"
```

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отчета.
Строка со "storeId":null соответствует резерву для Заказа Покупателя без указания склада.

```json
[
  {"assortmentId":"12345678-5838-aaeb-0a80-003a003ef439","storeId":"12345678-b123-aaee-0a80-012b0001bb10","freeStock":4},
  {"assortmentId":"12345678-5838-aaeb-0a80-003a003ef439","storeId":"12345678-b123-aaee-0a80-012b0001bb12","freeStock":7},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f847c","storeId":null, "freeStock":-5},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f847c","storeId":"12345678-b123-aaee-0a80-012b0001bb10","freeStock":46}
]
```

> Запрос на получение текущих остатков с фильтрацией.

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/report/stock/bystore/current?filter=assortmentId=12345678-5838-aaeb-0a80-003a003ef439,12345678-279c-aaeb-0a80-00d6001f847c;storeId=12345678-b123-aaee-0a80-012b0001bb10,12345678-b123-aaee-0a80-012b0001bb13"
  -H "Authorization: Basic <Credentials>"
```

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отчета.

```json
[
  {"assortmentId":"12345678-5838-aaeb-0a80-003a003ef439","storeId":"12345678-b123-aaee-0a80-012b0001bb10","stock":1},
  {"assortmentId":"12345678-279c-aaeb-0a80-00d6001f847c","storeId":"12345678-b123-aaee-0a80-012b0001bb10","stock":3}
]
```
